<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CodeVengers|Lack of Coordination Between Local and Fedral goverment </title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Noto+Sans+Devanagari:wght@400;500;600;700;800&display=swap"
        rel="stylesheet">
</head>

<body>
    <!-- Background Pattern -->
    <div class="bg-pattern"></div>
    <style>
        .header {

            position: absolute;
            top: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-light);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            z-index: 100;
            transition: var(--transition);

        }
    </style>
    <!-- Header -->
    <header class="header">
        <div class="container header-content">
            <div class="header-left">
                <button class="mobile-menu-btn" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="logo-section">
                    <div class="logo-icon">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="logo-text">
                        <h1 data-i18n="app_name">Smart Nepal</h1>
                        <p data-i18n="app_subtitle">Nepal e-Governance</p>
                    </div>
                </div>
            </div>

            <div class="header-center">
                <div class="search-header">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search services, documents..." id="globalSearch"
                        data-i18n-placeholder="header_search">
                </div>
            </div>

            <div class="header-right">
                <button class="icon-btn" onclick="toggleTheme()" title="Toggle Theme">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </button>
                <button class="icon-btn" onclick="toggleNotifications()" title="Notifications">
                    <i class="fas fa-bell"></i>
                    <span class="notification-badge" id="notificationCount">3</span>
                </button>
                <button class="icon-btn" onclick="toggleTopLanguage()" title="Toggle Language" id="langToggle"
                    style="position: relative;">
                    <i class="fas fa-language"></i>
                    <span id="currentLanguage"
                        style="position: absolute; right: 0.25rem; bottom: 0.25rem; font-weight: 700; font-size: 0.7rem; background: var(--primary-blue); color: white; width: 1rem; height: 1rem; border-radius: 50%; display: flex; align-items: center; justify-content: center;">EN</span>
                </button>
            </div>
        </div>



        <div class="main-layout">
            <!-- Sidebar -->
            <aside class="sidebar" id="sidebar">
                <nav class="nav-menu">
                    <button class="nav-btn active" onclick="showTab('dashboard')">
                        <i class="fas fa-home"></i>
                        <span data-i18n="sidebar_dashboard">Dashboard</span>
                    </button>
                    <button class="nav-btn" onclick="showTab('ai-assistant')">
                        <i class="fas fa-robot"></i>
                        <span data-i18n="sidebar_ai">AI Assistant</span>
                    </button>
                    <button class="nav-btn" onclick="showTab('services')">
                        <i class="fas fa-briefcase"></i>
                        <span data-i18n="sidebar_services">All Services</span>
                    </button>
                    <button class="nav-btn" onclick="showTab('news')">
                        <i class="fas fa-newspaper"></i>
                        <span>Government News</span>
                    </button>
                    <button class="nav-btn" onclick="showTab('applications')">
                        <i class="fas fa-file-alt"></i>
                        <span data-i18n="sidebar_applications">My Applications</span>
                    </button>
                    <button class="nav-btn" onclick="showTab('settings')">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                </nav>


                <div class="contact-card">
                    <h4><i class="fas fa-phone"></i> Emergency Contact</h4>
                    <a href="tel:100" class="contact-item">
                        <div class="contact-icon red">
                            <i class="fas fa-phone"></i>
                        </div>
                        <div>
                            <span data-i18n="contact_police">Police</span>
                            <strong>100</strong>
                        </div>
                    </a>
                    <a href="tel:1660-01-55555" class="contact-item">
                        <div class="contact-icon blue">
                            <i class="fas fa-headset"></i>
                        </div>
                        <div>
                            <span data-i18n="contact_support">Support</span>
                            <strong>1660-01-55555</strong>
                        </div>
                    </a>
                </div>

            </aside>

            <!-- Main Content -->
            <main class="content">
                <!-- Dashboard Tab -->
                <div id="dashboard-tab" class="tab-content active">
                    <div class="page-header">
                        <!DOCTYPE html>
                        <html lang="en">

                        <head>
                            <meta charset="UTF-8">
                            <meta name="viewport" content="width=device-width, initial-scale=1.0">
                            <title>Province Government - Admin Panel | Coordination Hub</title>
                            <link rel="stylesheet" href="styles.css">
                            <link rel="stylesheet"
                                href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
                            <link
                                href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&family=Noto+Sans+Devanagari:wght@400;500;600;700;800&display=swap"
                                rel="stylesheet">
                            <style>
                                .admin-container {
                                    max-width: 1400px;
                                    margin: 0 auto;
                                    padding: 2rem;
                                }

                                .admin-header {
                                    background: linear-gradient(135deg, #1e40af, #dc2626);
                                    color: white;
                                    padding: 2rem;
                                    border-radius: 1.5rem;
                                    margin-bottom: 2rem;
                                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                                }

                                .admin-header h1 {
                                    font-size: 2.5rem;
                                    margin-bottom: 0.5rem;
                                    display: flex;
                                    align-items: center;
                                    gap: 1rem;
                                }

                                .admin-header p {
                                    opacity: 0.9;
                                    font-size: 1.1rem;
                                }

                                .admin-nav {
                                    display: flex;
                                    gap: 1rem;
                                    margin-bottom: 2rem;
                                    flex-wrap: wrap;
                                }

                                .admin-nav-btn {
                                    padding: 1rem 2rem;
                                    background: rgba(255, 255, 255, 0.9);
                                    border: 2px solid #e2e8f0;
                                    border-radius: 0.75rem;
                                    cursor: pointer;
                                    font-weight: 600;
                                    transition: all 0.3s ease;
                                    display: flex;
                                    align-items: center;
                                    gap: 0.5rem;
                                }

                                .admin-nav-btn:hover {
                                    background: linear-gradient(135deg, #1e40af, #dc2626);
                                    color: white;
                                    border-color: transparent;
                                    transform: translateY(-2px);
                                }

                                .admin-nav-btn.active {
                                    background: linear-gradient(135deg, #1e40af, #dc2626);
                                    color: white;
                                    border-color: transparent;
                                }

                                .admin-section {
                                    display: none;
                                    animation: fadeInUp 0.4s ease;
                                }

                                .admin-section.active {
                                    display: block;
                                }

                                .notice-form {
                                    background: rgba(255, 255, 255, 0.9);
                                    backdrop-filter: blur(20px);
                                    border-radius: 1.5rem;
                                    padding: 2rem;
                                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                                    border: 1px solid #e2e8f0;
                                    margin-bottom: 2rem;
                                }

                                .form-group {
                                    margin-bottom: 1.5rem;
                                }

                                .form-group label {
                                    display: block;
                                    font-weight: 600;
                                    margin-bottom: 0.5rem;
                                    color: #1e293b;
                                }

                                .form-group input,
                                .form-group textarea,
                                .form-group select {
                                    width: 100%;
                                    padding: 0.75rem 1rem;
                                    border: 2px solid #e2e8f0;
                                    border-radius: 0.75rem;
                                    font-size: 1rem;
                                    transition: all 0.3s ease;
                                    font-family: inherit;
                                }

                                .form-group input:focus,
                                .form-group textarea:focus,
                                .form-group select:focus {
                                    outline: none;
                                    border-color: #1e40af;
                                    box-shadow: 0 0 0 3px rgba(30, 64, 175, 0.1);
                                }

                                .form-group textarea {
                                    min-height: 120px;
                                    resize: vertical;
                                }

                                .priority-badges {
                                    display: flex;
                                    gap: 1rem;
                                    flex-wrap: wrap;
                                }

                                .priority-badge {
                                    padding: 0.5rem 1rem;
                                    border-radius: 0.5rem;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    font-weight: 600;
                                    border: 2px solid transparent;
                                }

                                .priority-badge.high {
                                    background: rgba(239, 68, 68, 0.1);
                                    color: #dc2626;
                                    border-color: #dc2626;
                                }

                                .priority-badge.medium {
                                    background: rgba(245, 158, 11, 0.1);
                                    color: #f59e0b;
                                    border-color: #f59e0b;
                                }

                                .priority-badge.low {
                                    background: rgba(100, 116, 139, 0.1);
                                    color: #64748b;
                                    border-color: #64748b;
                                }

                                .priority-badge.selected {
                                    background: linear-gradient(135deg, #1e40af, #dc2626);
                                    color: white;
                                    border-color: transparent;
                                }

                                .icon-selector {
                                    display: grid;
                                    grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
                                    gap: 0.5rem;
                                    margin-top: 0.5rem;
                                }

                                .icon-option {
                                    padding: 1rem;
                                    border: 2px solid #e2e8f0;
                                    border-radius: 0.5rem;
                                    cursor: pointer;
                                    text-align: center;
                                    transition: all 0.3s ease;
                                    font-size: 1.5rem;
                                }

                                .icon-option:hover {
                                    border-color: #1e40af;
                                    background: rgba(30, 64, 175, 0.1);
                                }

                                .icon-option.selected {
                                    background: linear-gradient(135deg, #1e40af, #dc2626);
                                    color: white;
                                    border-color: transparent;
                                }

                                .notices-list {
                                    background: rgba(255, 255, 255, 0.9);
                                    backdrop-filter: blur(20px);
                                    border-radius: 1.5rem;
                                    padding: 2rem;
                                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                                    border: 1px solid #e2e8f0;
                                }

                                .notice-card {
                                    background: rgba(100, 116, 139, 0.05);
                                    border-radius: 1rem;
                                    padding: 1.5rem;
                                    margin-bottom: 1rem;
                                    border-left: 4px solid #1e40af;
                                    transition: all 0.3s ease;
                                }

                                .notice-card:hover {
                                    transform: translateX(5px);
                                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
                                }

                                .notice-card.high {
                                    border-left-color: #dc2626;
                                }

                                .notice-card.medium {
                                    border-left-color: #f59e0b;
                                }

                                .notice-card.low {
                                    border-left-color: #64748b;
                                }

                                .notice-card-header {
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: flex-start;
                                    margin-bottom: 1rem;
                                }

                                .notice-card-title {
                                    font-size: 1.25rem;
                                    font-weight: 700;
                                    color: #1e293b;
                                    margin-bottom: 0.5rem;
                                }

                                .notice-card-meta {
                                    display: flex;
                                    gap: 1rem;
                                    font-size: 0.85rem;
                                    color: #64748b;
                                    flex-wrap: wrap;
                                }

                                .notice-card-actions {
                                    display: flex;
                                    gap: 0.5rem;
                                }

                                .btn-small {
                                    padding: 0.5rem 1rem;
                                    border: none;
                                    border-radius: 0.5rem;
                                    cursor: pointer;
                                    font-weight: 600;
                                    transition: all 0.3s ease;
                                    font-size: 0.85rem;
                                }

                                .btn-edit {
                                    background: rgba(59, 130, 246, 0.1);
                                    color: #3b82f6;
                                }

                                .btn-edit:hover {
                                    background: #3b82f6;
                                    color: white;
                                }

                                .btn-delete {
                                    background: rgba(239, 68, 68, 0.1);
                                    color: #ef4444;
                                }

                                .btn-delete:hover {
                                    background: #ef4444;
                                    color: white;
                                }

                                .btn-publish {
                                    background: linear-gradient(135deg, #1e40af, #dc2626);
                                    color: white;
                                    padding: 1rem 2rem;
                                    border: none;
                                    border-radius: 0.75rem;
                                    font-weight: 700;
                                    font-size: 1rem;
                                    cursor: pointer;
                                    transition: all 0.3s ease;
                                    width: 100%;
                                    margin-top: 1rem;
                                }

                                .btn-publish:hover {
                                    transform: translateY(-2px);
                                    box-shadow: 0 10px 30px rgba(30, 64, 175, 0.3);
                                }

                                .stats-grid {
                                    display: grid;
                                    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                                    gap: 1.5rem;
                                    margin-bottom: 2rem;
                                }

                                .stat-card {
                                    background: rgba(255, 255, 255, 0.9);
                                    backdrop-filter: blur(20px);
                                    border-radius: 1.5rem;
                                    padding: 1.5rem;
                                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                                    border: 1px solid #e2e8f0;
                                }

                                .stat-card h3 {
                                    font-size: 2.5rem;
                                    font-weight: 800;
                                    background: linear-gradient(135deg, #1e40af, #dc2626);
                                    -webkit-background-clip: text;
                                    background-clip: text;
                                    -webkit-text-fill-color: transparent;
                                    margin-bottom: 0.5rem;
                                }

                                .stat-card p {
                                    color: #64748b;
                                    font-weight: 600;
                                }

                                .sync-status {
                                    display: flex;
                                    align-items: center;
                                    gap: 0.5rem;
                                    padding: 0.75rem 1rem;
                                    background: rgba(16, 185, 129, 0.1);
                                    border-radius: 0.5rem;
                                    color: #10b981;
                                    font-weight: 600;
                                    margin-bottom: 1rem;
                                }

                                .sync-status.syncing {
                                    background: rgba(245, 158, 11, 0.1);
                                    color: #f59e0b;
                                }

                                .empty-state {
                                    text-align: center;
                                    padding: 3rem;
                                    color: #64748b;
                                }

                                .empty-state i {
                                    font-size: 4rem;
                                    margin-bottom: 1rem;
                                    opacity: 0.5;
                                }

                                @keyframes fadeInUp {
                                    from {
                                        opacity: 0;
                                        transform: translateY(20px);
                                    }

                                    to {
                                        opacity: 1;
                                        transform: translateY(0);
                                    }
                                }

                                .coordination-panel {
                                    background: rgba(255, 255, 255, 0.9);
                                    backdrop-filter: blur(20px);
                                    border-radius: 1.5rem;
                                    padding: 2rem;
                                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
                                    border: 1px solid #e2e8f0;
                                    margin-bottom: 2rem;
                                }

                                .coordination-item {
                                    display: flex;
                                    justify-content: space-between;
                                    align-items: center;
                                    padding: 1rem;
                                    background: rgba(100, 116, 139, 0.05);
                                    border-radius: 0.75rem;
                                    margin-bottom: 1rem;
                                }

                                .coordination-item-info h4 {
                                    margin-bottom: 0.25rem;
                                }

                                .coordination-item-info p {
                                    font-size: 0.85rem;
                                    color: #64748b;
                                }

                                .toast {
                                    position: fixed;
                                    top: 1rem;
                                    right: 1rem;
                                    background: rgba(255, 255, 255, 0.95);
                                    backdrop-filter: blur(10px);
                                    padding: 1rem 1.5rem;
                                    border-radius: 1rem;
                                    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
                                    display: flex;
                                    align-items: center;
                                    gap: 0.75rem;
                                    z-index: 1000;
                                    animation: slideIn 0.3s ease;
                                    border: 2px solid #10b981;
                                }

                                .toast.hidden {
                                    display: none;
                                }

                                @keyframes slideIn {
                                    from {
                                        transform: translateX(400px);
                                        opacity: 0;
                                    }

                                    to {
                                        transform: translateX(0);
                                        opacity: 1;
                                    }
                                }

                                body.dark-mode .notice-form,
                                body.dark-mode .notices-list,
                                body.dark-mode .stat-card,
                                body.dark-mode .coordination-panel {
                                    background: rgba(30, 41, 59, 0.9);
                                    border-color: #334155;
                                    color: #f8fafc;
                                }

                                body.dark-mode .form-group label,
                                body.dark-mode .notice-card-title {
                                    color: #f8fafc;
                                }

                                body.dark-mode .form-group input,
                                body.dark-mode .form-group textarea,
                                body.dark-mode .form-group select {
                                    background: rgba(30, 41, 59, 0.5);
                                    border-color: #334155;
                                    color: #f8fafc;
                                }
                            </style>
                        </head>

                        <body>
                            <!-- Toast Notification -->
                            <div id="toast" class="toast hidden">
                                <i class="fas fa-check-circle"></i>
                                <span id="toastMessage">Success!</span>
                            </div>

                            <div class="admin-container">
                                <!-- Admin Header -->
                                <div class="admin-header">
                                    <h1>
                                        <i class="fas fa-landmark"></i>
                                        Federal Government Admin Panel
                                    </h1>
                                    <p>Coordination Hub - Manage Notices & Data for Citizen Portal</p>
                                    <div class="sync-status" id="syncStatus">
                                        <i class="fas fa-sync-alt"></i>
                                        <span>Data Synced with Citizen Portal</span>
                                    </div>
                                </div>

                                <!-- Navigation -->
                                <div class="admin-nav">
                                    <button class="admin-nav-btn active" onclick="showSection('notices')">
                                        <i class="fas fa-bullhorn"></i> Publish Notices
                                    </button>
                                    <button class="admin-nav-btn" onclick="showSection('manage')">
                                        <i class="fas fa-list"></i> Manage Notices
                                    </button>
                                    <button class="admin-nav-btn" onclick="showSection('coordination')">
                                        <i class="fas fa-network-wired"></i> Coordination Hub
                                    </button>
                                    <button class="admin-nav-btn" onclick="showSection('stats')">
                                        <i class="fas fa-chart-bar"></i> Statistics
                                    </button>
                                    <button class="admin-nav-btn" onclick="window.open('home.html', '_blank')">
                                        <i class="fas fa-external-link-alt"></i> View Citizen Portal
                                    </button>
                                </div>

                                <!-- Publish Notices Section -->
                                <div id="noticesSection" class="admin-section active">
                                    <div class="notice-form">
                                        <h2
                                            style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                            <i class="fas fa-plus-circle"></i> Publish New Notice
                                        </h2>
                                        <form id="noticeForm" onsubmit="publishNotice(event)">
                                            <div class="form-group">
                                                <label>Notice Title *</label>
                                                <input type="text" id="noticeTitle" required
                                                    placeholder="Enter notice title">
                                            </div>
                                            <div class="form-group">
                                                <label>Description *</label>
                                                <textarea id="noticeDesc" required
                                                    placeholder="Enter notice description"></textarea>
                                            </div>
                                            <div class="form-row"
                                                style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                                <div class="form-group">
                                                    <label>Priority *</label>
                                                    <div class="priority-badges">
                                                        <span class="priority-badge high"
                                                            onclick="selectPriority('high', this)">High</span>
                                                        <span class="priority-badge medium selected"
                                                            onclick="selectPriority('medium', this)">Medium</span>
                                                        <span class="priority-badge low"
                                                            onclick="selectPriority('low', this)">Low</span>
                                                    </div>
                                                    <input type="hidden" id="noticePriority" value="medium">
                                                </div>
                                                <div class="form-group">
                                                    <label>Icon</label>
                                                    <select id="noticeIcon" class="form-group select">
                                                        <option value="fa-bullhorn">Bullhorn</option>
                                                        <option value="fa-bell">Bell</option>
                                                        <option value="fa-exclamation-triangle">Warning</option>
                                                        <option value="fa-info-circle">Info</option>
                                                        <option value="fa-check-circle">Check</option>
                                                        <option value="fa-newspaper">News</option>
                                                        <option value="fa-calendar">Calendar</option>
                                                        <option value="fa-file-alt">Document</option>
                                                    </select>
                                                </div>
                                            </div>
                                            <div class="form-group">
                                                <label>Link (Optional)</label>
                                                <input type="url" id="noticeLink" placeholder="https://example.com">
                                            </div>
                                            <button type="submit" class="btn-publish">
                                                <i class="fas fa-paper-plane"></i> Publish Notice
                                            </button>
                                        </form>
                                    </div>
                                </div>

                                <!-- Manage Notices Section -->
                                <div id="manageSection" class="admin-section">
                                    <div class="notices-list">
                                        <h2
                                            style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                            <i class="fas fa-list"></i> Published Notices
                                        </h2>
                                        <div id="noticesList">
                                            <!-- Notices will be loaded here -->
                                        </div>
                                    </div>
                                </div>

                                <!-- Coordination Hub Section -->
                                <div id="coordinationSection" class="admin-section">
                                    <div class="coordination-panel">
                                        <h2
                                            style="margin-bottom: 1.5rem; display: flex; align-items: center; gap: 0.5rem;">
                                            <i class="fas fa-network-wired"></i> Federal-Local Coordination
                                        </h2>
                                        <div class="coordination-item">
                                            <div class="coordination-item-info">
                                                <h4>Data Synchronization</h4>
                                                <p>Real-time sync with federal government systems</p>
                                            </div>
                                            <button class="btn-small btn-edit" onclick="syncData()">
                                                <i class="fas fa-sync"></i> Sync Now
                                            </button>
                                        </div>
                                        <div class="coordination-item">
                                            <div class="coordination-item-info">
                                                <h4>Notice Distribution</h4>
                                                <p>Notices published here appear instantly on citizen portal</p>
                                            </div>
                                            <span style="color: #10b981; font-weight: 600;">
                                                <i class="fas fa-check-circle"></i> Active
                                            </span>
                                        </div>
                                        <div class="coordination-item">
                                            <div class="coordination-item-info">
                                                <h4>Cross-Government Communication</h4>
                                                <p>Share notices with other provinces and federal level</p>
                                            </div>
                                            <button class="btn-small btn-edit" onclick="shareWithFederal()">
                                                <i class="fas fa-share"></i> Share
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <!-- Statistics Section -->
                                <div id="statsSection" class="admin-section">
                                    <div class="stats-grid">
                                        <div class="stat-card">
                                            <h3 id="totalNotices">0</h3>
                                            <p>Total Notices Published</p>
                                        </div>
                                        <div class="stat-card">
                                            <h3 id="activeNotices">0</h3>
                                            <p>Active Notices</p>
                                        </div>
                                        <div class="stat-card">
                                            <h3 id="highPriority">0</h3>
                                            <p>High Priority Notices</p>
                                        </div>
                                        <div class="stat-card">
                                            <h3 id="lastSync">-</h3>
                                            <p>Last Sync Time</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <script>
                                // Backend API Configuration
                                const API_BASE_URL = 'http://localhost:3000/api';

                                // Initialize
                                document.addEventListener('DOMContentLoaded', function () {
                                    checkBackendConnection();
                                    loadNotices();
                                    updateStats();
                                    updateSyncStatus();
                                });

                                // Check backend connection
                                async function checkBackendConnection() {
                                    try {
                                        const response = await Access(`${API_BASE_URL}/health`);
                                        const data = await response.json();
                                        if (data.success) {
                                            console.log('✅ Backend connected:', data.message);
                                        }
                                    } catch (error) {
                                        console.error('❌ Backend connection failed:', error);
                                        showToast('⚠️ Backend server not running. Please start the server (npm start)', 'error');
                                    }
                                }

                                // Section Navigation
                                function showSection(section) {
                                    document.querySelectorAll('.admin-section').forEach(s => s.classList.remove('active'));
                                    document.querySelectorAll('.admin-nav-btn').forEach(b => b.classList.remove('active'));

                                    document.getElementById(section + 'Section').classList.add('active');
                                    event.target.classList.add('active');
                                }

                                // Priority Selection
                                function selectPriority(priority, element) {
                                    document.querySelectorAll('.priority-badge').forEach(b => b.classList.remove('selected'));
                                    element.classList.add('selected');
                                    document.getElementById('noticePriority').value = priority;
                                }

                                // Publish Notice
                                async function publishNotice(event) {
                                    event.preventDefault();

                                    const form = document.getElementById('noticeForm');
                                    const editId = form.dataset.editId;
                                    const noticeData = {
                                        title: document.getElementById('noticeTitle').value,
                                        desc: document.getElementById('noticeDesc').value,
                                        priority: document.getElementById('noticePriority').value,
                                        icon: document.getElementById('noticeIcon').value,
                                        link: document.getElementById('noticeLink').value || null,
                                        publishedBy: 'Province Government'
                                    };

                                    try {
                                        let response;
                                        if (editId) {
                                            // Update existing notice
                                            response = await Access(`${API_BASE_URL}/notices/${editId}`, {
                                                method: 'PUT',
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                body: JSON.stringify(noticeData)
                                            });
                                        } else {
                                            // Create new notice
                                            response = await Access(`${API_BASE_URL}/notices`, {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json'
                                                },
                                                body: JSON.stringify(noticeData)
                                            });
                                        }

                                        const result = await response.json();

                                        if (result.success) {
                                            showToast(editId ? 'Notice updated successfully!' : 'Notice published successfully! All portals will see it instantly.');

                                            // Reset form
                                            form.reset();
                                            delete form.dataset.editId;
                                            document.querySelectorAll('.priority-badge').forEach(b => b.classList.remove('selected'));
                                            document.querySelector('.priority-badge.medium').classList.add('selected');
                                            document.getElementById('noticePriority').value = 'medium';

                                            // Reload notices list
                                            await loadNotices();
                                            await updateStats();
                                            updateSyncStatus();
                                        } else {
                                            showToast('Error: ' + result.error, 'error');
                                        }
                                    } catch (error) {
                                        console.error('Error publishing notice:', error);
                                        showToast('Failed to publish notice. Is the backend server running?', 'error');
                                    }
                                }

                                // Load Notices
                                async function loadNotices() {
                                    const noticesList = document.getElementById('noticesList');

                                    try {
                                        const response = await Access(`${API_BASE_URL}/notices`);
                                        const result = await response.json();

                                        if (!result.success) {
                                            throw new Error(result.error || 'Failed to load notices');
                                        }

                                        const notices = result.data || [];

                                        if (notices.length === 0) {
                                            noticesList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-inbox"></i>
                            <h3>No notices published yet</h3>
                            <p>Start by publishing your first notice!</p>
                        </div>
                    `;
                                            return;
                                        }

                                        noticesList.innerHTML = notices.map(notice => `
                    <div class="notice-card ${notice.priority}">
                        <div class="notice-card-header">
                            <div>
                                <div class="notice-card-title">${notice.title}</div>
                                <div class="notice-card-meta">
                                    <span><i class="fas fa-calendar"></i> ${new Date(notice.date || notice.createdAt).toLocaleDateString()}</span>
                                    <span><i class="fas fa-tag"></i> ${notice.priority.toUpperCase()}</span>
                                    <span><i class="fas fa-user"></i> ${notice.publishedBy || 'Admin'}</span>
                                </div>
                            </div>
                            <div class="notice-card-actions">
                                <button class="btn-small btn-edit" onclick="editNotice(${notice.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn-small btn-delete" onclick="deleteNotice(${notice.id})">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </div>
                        <p style="color: #64748b; margin-top: 0.5rem;">${notice.desc || notice.description}</p>
                        ${notice.link ? `<a href="${notice.link}" target="_blank" style="color: #1e40af; text-decoration: none; margin-top: 0.5rem; display: inline-block;"><i class="fas fa-external-link-alt"></i> View Link</a>` : ''}
                    </div>
                `).join('');
                                    } catch (error) {
                                        console.error('Error loading notices:', error);
                                        noticesList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Error loading notices</h3>
                        <p>Please make sure the backend server is running (npm start)</p>
                    </div>
                `;
                                    }
                                }

                                // Delete Notice
                                async function deleteNotice(id) {
                                    if (!confirm('Are you sure you want to delete this notice?')) return;

                                    try {
                                        const response = await Access(`${API_BASE_URL}/notices/${id}`, {
                                            method: 'DELETE'
                                        });

                                        const result = await response.json();

                                        if (result.success) {
                                            showToast('Notice deleted successfully!');
                                            await loadNotices();
                                            await updateStats();
                                        } else {
                                            showToast('Error: ' + result.error, 'error');
                                        }
                                    } catch (error) {
                                        console.error('Error deleting notice:', error);
                                        showToast('Failed to delete notice. Is the backend server running?', 'error');
                                    }
                                }

                                // Edit Notice
                                async function editNotice(id) {
                                    try {
                                        const response = await Access(`${API_BASE_URL}/notices/${id}`);
                                        const result = await response.json();

                                        if (!result.success || !result.data) {
                                            showToast('Notice not found', 'error');
                                            return;
                                        }

                                        const notice = result.data;

                                        // Fill form with notice data
                                        document.getElementById('noticeTitle').value = notice.title;
                                        document.getElementById('noticeDesc').value = notice.desc || notice.description;
                                        document.getElementById('noticePriority').value = notice.priority;
                                        document.getElementById('noticeIcon').value = notice.icon || 'fa-bullhorn';
                                        document.getElementById('noticeLink').value = notice.link || '';

                                        // Update priority badges
                                        document.querySelectorAll('.priority-badge').forEach(b => b.classList.remove('selected'));
                                        const priorityBadge = document.querySelector(`.priority-badge.${notice.priority}`);
                                        if (priorityBadge) priorityBadge.classList.add('selected');

                                        // Store edit ID for update
                                        document.getElementById('noticeForm').dataset.editId = id;

                                        // Scroll to form
                                        showSection('notices');
                                        document.getElementById('noticeForm').scrollIntoView({ behavior: 'smooth' });

                                        showToast('Notice loaded for editing. Make changes and publish to update.');
                                    } catch (error) {
                                        console.error('Error loading notice:', error);
                                        showToast('Failed to load notice for editing', 'error');
                                    }
                                }

                                // Update Statistics
                                async function updateStats() {
                                    try {
                                        const response = await Access(`${API_BASE_URL}/stats`);
                                        const result = await response.json();

                                        if (result.success && result.data) {
                                            const stats = result.data;
                                            document.getElementById('totalNotices').textContent = stats.total || 0;
                                            document.getElementById('activeNotices').textContent = stats.active || 0;
                                            document.getElementById('highPriority').textContent = stats.highPriority || 0;
                                        }
                                    } catch (error) {
                                        console.error('Error loading stats:', error);
                                        document.getElementById('totalNotices').textContent = '0';
                                        document.getElementById('activeNotices').textContent = '0';
                                        document.getElementById('highPriority').textContent = '0';
                                    }
                                }

                                // Sync Status
                                function updateSyncStatus() {
                                    const syncStatus = document.getElementById('syncStatus');
                                    syncStatus.classList.add('syncing');
                                    syncStatus.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> <span>Syncing...</span>';

                                    setTimeout(() => {
                                        syncStatus.classList.remove('syncing');
                                        syncStatus.innerHTML = '<i class="fas fa-check-circle"></i> <span>Data Synced with Citizen Portal</span>';
                                        document.getElementById('lastSync').textContent = new Date().toLocaleTimeString();
                                    }, 1000);
                                }

                                // Sync Data
                                function syncData() {
                                    updateSyncStatus();
                                    showToast('Data synchronized successfully!');
                                }

                                // Share with Federal
                                function shareWithFederal() {
                                    showToast('Notice shared with federal government and other provinces!');
                                }

                                // Toast Notification
                                function showToast(message, type = 'success') {
                                    const toast = document.getElementById('toast');
                                    const toastMessage = document.getElementById('toastMessage');
                                    toastMessage.textContent = message;

                                    // Update toast style based on type
                                    if (type === 'error') {
                                        toast.style.borderColor = '#dc2626';
                                        toast.querySelector('i').className = 'fas fa-exclamation-circle';
                                    } else {
                                        toast.style.borderColor = '#10b981';
                                        toast.querySelector('i').className = 'fas fa-check-circle';
                                    }

                                    toast.classList.remove('hidden');

                                    setTimeout(() => {
                                        toast.classList.add('hidden');
                                    }, 3000);
                                }

                                // Auto-refresh notices every 30 seconds
                                setInterval(async () => {
                                    if (document.getElementById('manageSection').classList.contains('active')) {
                                        await loadNotices();
                                        await updateStats();
                                    }
                                }, 30000);
                            </script>
                        </body>

                        </html>

                    </div>
                </div>

                <!-- AI Assistant Tab -->
                <div id="ai-assistant-tab" class="tab-content">
                    <div class="ai-container">
                        <div class="ai-sidebar">
                            <h3 data-i18n="chat_history">Chat History</h3>
                            <button class="new-chat-btn" onclick="newChat()">
                                <i class="fas fa-plus"></i> <span data-i18n="new_chat">New Chat</span>
                            </button>
                            <div class="chat-history-list" id="chatHistory">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <div class="ai-main">
                            <div class="ai-header-enhanced">
                                <div class="ai-icon-large">
                                    <i class="fas fa-robot"></i>
                                </div>
                                <div class="ai-title-section">
                                    <h2 data-i18n="ai_title">AI-Powered Service Assistant</h2>
                                    <p data-i18n="ai_subtitle">बुद्धिमान सहायक - Ask anything about government services
                                    </p>
                                </div>
                                <div class="ai-actions">
                                    <button class="icon-btn" onclick="toggleVoiceMode()" title="Voice Mode">
                                        <i class="fas fa-microphone"></i>
                                    </button>
                                    <button class="icon-btn" onclick="shareChat()" title="Share Chat">
                                        <i class="fas fa-share-alt"></i>
                                    </button>
                                    <button class="icon-btn" onclick="clearChat()" title="Clear Chat">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>

                            <div class="ai-features-bar">
                                <div class="feature-chip">
                                    <i class="fas fa-clock"></i> 24/7 Available
                                </div>
                                <div class="feature-chip">
                                    <i class="fas fa-language"></i> Bilingual
                                </div>
                                <div class="feature-chip">
                                    <i class="fas fa-shield-alt"></i> Secure
                                </div>
                                <div class="feature-chip">
                                    <i class="fas fa-brain"></i> AI-Powered
                                </div>
                            </div>

                            <div class="chat-container-enhanced">
                                <div class="chat-messages-enhanced" id="chatMessages">
                                    <div class="chat-welcome">
                                        <div class="welcome-icon">
                                            <i class="fas fa-hands-helping"></i>
                                        </div>
                                        <h3>Namaste! 🙏 How can I help you today?</h3>
                                        <p>I can assist you with citizenship, passport, licenses, and all government
                                            services</p>

                                        <div class="suggested-prompts">
                                            <button class="prompt-chip"
                                                onclick="sendPrompt('How do I apply for citizenship?')">
                                                📝 <span data-i18n="ai_citizenship">Apply for Citizenship</span>
                                            </button>
                                            <button class="prompt-chip"
                                                onclick="sendPrompt('Track my passport application')">
                                                🔍 <span data-i18n="ai_passport">Track Passport</span>
                                            </button>
                                            <button class="prompt-chip"
                                                onclick="sendPrompt('How to pay bills online?')">
                                                💳 <span data-i18n="ai_bills">Pay Bills</span>
                                            </button>
                                            <button class="prompt-chip"
                                                onclick="sendPrompt('नागरिकताको लागि कसरी आवेदन दिने?')">
                                                🇳🇵 <span data-i18n="ai_nepali">नेपालीमा सोध्नुहोस्</span>
                                            </button>
                                        </div>
                                    </div>
                                </div>

                                <div class="chat-input-container-enhanced">
                                    <div class="input-wrapper">
                                        <button class="input-action-btn" onclick="attachFile()" title="Attach File">
                                            <i class="fas fa-paperclip"></i>
                                        </button>
                                        <input type="text" id="userInput" class="chat-input-enhanced"
                                            data-i18n-placeholder="ai_placeholder" />
                                        <button class="input-action-btn voice-btn-enhanced"
                                            onclick="startVoiceRecognition()" id="voiceBtn">
                                            <i class="fas fa-microphone"></i>
                                        </button>
                                        <button class="send-btn-enhanced" onclick="sendMessage()">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                    <div class="input-footer">
                                        <span class="input-tip">
                                            <i class="fas fa-lightbulb"></i>
                                            <span data-i18n="input_tip">Press Enter to send</span>
                                        </span>
                                        <span class="ai-status">
                                            <span class="status-dot"></span> <span data-i18n="ai_status_ready">AI
                                                Ready</span>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ALL 120+ SERVICES TAB -->
                <div id="services-tab" class="tab-content">
                    <div class="page-header">
                        <div>
                            <h2 class="page-title"><i class="fas fa-briefcase"></i> All Government Services</h2>
                            <p class="page-subtitle">Featch Data 120+ government services in one place</p>
                        </div>
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="serviceSearch" placeholder="Search services..."
                                onkeyup="filterServices()">
                        </div>
                    </div>
                    <div class="services-category-tabs">
                        <button class="category-tab active" onclick="filterByCategory('all')">All</button>
                        <button class="category-tab" onclick="filterByCategory('citizenship')">Citizenship</button>
                        <button class="category-tab" onclick="filterByCategory('passport')">Passport</button>
                        <button class="category-tab" onclick="filterByCategory('documents')">Documents</button>
                        <button class="category-tab" onclick="filterByCategory('licenses')">Licenses</button>
                        <button class="category-tab" onclick="filterByCategory('payments')">Payments</button>
                        <button class="category-tab" onclick="filterByCategory('utilities')">Utilities</button>
                    </div>
                    <div class="services-grid" id="servicesGrid">
                        <!-- Services will be populated by JavaScript -->
                    </div>
                </div>

                <!-- NEWS PORTAL TAB -->
                <div id="news-tab" class="tab-content">
                    <div class="page-header">
                        <div>
                            <h2 class="page-title"><i class="fas fa-newspaper"></i> Government News Portal</h2>
                            <p class="page-subtitle">Stay updated with local and federal government changes</p>
                        </div>
                        <div class="news-filter-tabs">
                            <button class="filter-btn active" onclick="filterNews('all')">All News</button>
                            <button class="filter-btn" onclick="filterNews('federal')">Federal</button>
                            <button class="filter-btn" onclick="filterNews('provincial')">Provincial</button>
                            <button class="filter-btn" onclick="filterNews('local')">Local</button>
                        </div>
                    </div>

                    <div class="news-container">
                        <div class="news-main-section">
                            <div class="featured-news-card" id="featuredNews">
                                <!-- Featured news will be populated by JS -->
                            </div>

                            <div class="news-grid" id="newsGrid">
                                <!-- News items will be populated by JavaScript -->
                            </div>
                        </div>

                        <div class="news-sidebar">
                            <div class="news-widget">
                                <h3><i class="fas fa-fire"></i> Trending Updates</h3>
                                <div class="trending-list" id="trendingNews">
                                    <!-- Trending news -->
                                </div>
                            </div>

                            <div class="news-widget">
                                <h3><i class="fas fa-bullhorn"></i> Policy Changes</h3>
                                <div class="policy-list" id="policyChanges">
                                    <!-- Policy changes -->
                                </div>
                            </div>

                            <div class="news-widget">
                                <h3><i class="fas fa-calendar-alt"></i> Upcoming Events</h3>
                                <div class="events-list" id="upcomingEvents">
                                    <!-- Events -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- DOCUMENTS TAB -->
                <div id="documents-tab" class="tab-content">
                    <!-- Will be populated by JavaScript with all documents -->
                </div>

                <!-- Profile Tab -->
                <div id="profile-tab" class="tab-content">
                    <div class="profile-container">
                        <div class="profile-header-banner">
                            <button class="edit-banner-btn" onclick="editBanner()">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <div class="profile-main">
                            <div class="profile-sidebar-section">
                                <div class="profile-photo-section">
                                    <div class="profile-photo-large" id="profilePhotoLarge">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <button class="edit-photo-btn" onclick="editProfilePhoto()">
                                        <i class="fas fa-camera"></i>
                                    </button>
                                </div>
                                <h2 id="profileFullName">Guest User</h2>
                                <p class="profile-id">ID: <strong id="profileNationalId">NP-xxxx-xxxx</strong></p>
                                <div class="profile-stats-mini">
                                    <div>
                                        <strong>4</strong>
                                        <span>Applications</span>
                                    </div>
                                    <div>
                                        <strong>12</strong>
                                        <span>Documents</span>
                                    </div>
                                    <div>
                                        <strong>98%</strong>
                                        <span>Verified</span>
                                    </div>
                                </div>
                                <button class="btn-primary full-width" onclick="generateQR()">
                                    <i class="fas fa-qrcode"></i> Generate QR Code
                                </button>
                            </div>

                            <div class="profile-content-section">
                                <div class="profile-tabs">
                                    <button class="profile-tab-btn active" onclick="showProfileTab('personal')"
                                        data-i18n="profile_tab_personal">
                                        Personal Info
                                    </button>
                                    <button class="profile-tab-btn" onclick="showProfileTab('contact')"
                                        data-i18n="profile_tab_contact">
                                        Contact
                                    </button>
                                    <button class="profile-tab-btn" onclick="showProfileTab('documents')"
                                        data-i18n="profile_tab_documents">
                                        Documents
                                    </button>
                                    <button class="profile-tab-btn" onclick="showProfileTab('activity')"
                                        data-i18n="profile_tab_activity">
                                        Activity Log
                                    </button>
                                </div>

                                <div class="profile-tab-content active" id="profile-personal-tab">
                                    <div class="info-section">
                                        <div class="section-header">
                                            <h3 data-i18n="profile_personal">Basic Information</h3>
                                            <button class="btn-secondary" onclick="editProfile()">
                                                <i class="fas fa-edit"></i> Edit
                                            </button>
                                        </div>
                                        <div class="info-grid">
                                            <div class="info-item">
                                                <label>Full Name</label>
                                                <p id="infoFullName">-</p>
                                            </div>
                                            <div class="info-item">
                                                <label>नेपाली नाम</label>
                                                <p id="infoFullNameNp">-</p>
                                            </div>
                                            <div class="info-item">
                                                <label>Date of Birth</label>
                                                <p id="infoDob">-</p>
                                            </div>
                                            <div class="info-item">
                                                <label>Gender</label>
                                                <p id="infoGender">-</p>
                                            </div>
                                            <div class="info-item">
                                                <label>Blood Group</label>
                                                <p id="infoBloodGroup">-</p>
                                            </div>
                                            <div class="info-item">
                                                <label>Citizenship No.</label>
                                                <p id="infoCitizenship">-</p>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="info-section">
                                        <div class="section-header">
                                            <h3 data-i18n="profile_address">Address Information</h3>
                                            <button class="btn-secondary" onclick="editAddress()">
                                                <i class="fas fa-edit"></i> Edit
                                            </button>
                                        </div>
                                        <div class="info-grid">
                                            <div class="info-item">
                                                <label>Province</label>
                                                <p id="infoProvince">-</p>
                                            </div>
                                            <div class="info-item">
                                                <label>District</label>
                                                <p id="infoDistrict">-</p>
                                            </div>
                                            <div class="info-item">
                                                <label>Municipality</label>
                                                <p id="infoMunicipality">-</p>
                                            </div>
                                            <div class="info-item">
                                                <label>Ward No.</label>
                                                <p id="infoWard">-</p>
                                            </div>
                                            <div class="info-item full-width">
                                                <label>Complete Address</label>
                                                <p id="infoFullAddress">-</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Settings Tab -->
                <div id="settings-tab" class="tab-content">
                    <h2 class="page-title"><i class="fas fa-cog"></i> <span data-i18n="settings_title">Settings</span>
                    </h2>

                    <div class="settings-container">
                        <div class="settings-sidebar">
                            <button class="settings-nav-btn active" data-section="general">
                                <i class="fas fa-sliders-h"></i> General
                            </button>
                            <button class="settings-nav-btn" data-section="appearance">
                                <i class="fas fa-palette"></i> Appearance
                            </button>
                            <button class="settings-nav-btn" data-section="notifications">
                                <i class="fas fa-bell"></i> <span
                                    data-i18n="settings_notifications">Notifications</span>
                            </button>
                            <button class="settings-nav-btn" data-section="privacy">
                                <i class="fas fa-shield-alt"></i> Privacy
                            </button>
                            <button class="settings-nav-btn" data-section="security">
                                <i class="fas fa-lock"></i> Security
                            </button>
                        </div>

                        <div class="settings-content">
                            <!-- General Settings -->
                            <div class="settings-section active" id="general-settings">
                                <h3 data-i18n="general_settings">General Settings</h3>

                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label>Auto-save Forms</label>
                                        <p>Automatically save form progress</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="autoSave" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>

                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label>Remember Login</label>
                                        <p>Stay logged in on this device</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" id="rememberLogin" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <!-- Other settings sections -->
                            <div class="settings-section" id="appearance-settings">
                                <h3>Appearance</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label>Theme</label>
                                        <p>Choose your preferred theme</p>
                                    </div>
                                    <div class="theme-selector">
                                        <button class="theme-btn active" onclick="toggleTheme()">
                                            <i class="fas fa-sun"></i> Light
                                        </button>
                                        <button class="theme-btn" onclick="toggleTheme()">
                                            <i class="fas fa-moon"></i> Dark
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <div class="settings-section" id="notifications-settings">
                                <h3>Notification Preferences</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label>Push Notifications</label>
                                        <p>Receive alerts for important updates</p>
                                    </div>
                                    <label class="toggle-switch">
                                        <input type="checkbox" checked>
                                        <span class="toggle-slider"></span>
                                    </label>
                                </div>
                            </div>

                            <div class="settings-section" id="privacy-settings">
                                <h3>Privacy & Data</h3>
                                <div class="privacy-actions">
                                    <button class="btn-secondary" onclick="downloadMyData()">
                                        <i class="fas fa-download"></i> Download My Data
                                    </button>
                                    <button class="btn-secondary" onclick="requestDataDeletion()">
                                        <i class="fas fa-trash"></i> Request Data Deletion
                                    </button>
                                </div>
                            </div>

                            <div class="settings-section" id="security-settings">
                                <h3 data-i18n="settings_security">Security Settings</h3>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label>Two-Factor Authentication</label>
                                        <p>Add extra security to your account</p>
                                    </div>
                                    <button class="btn-primary" onclick="setup2FA()">
                                        <i class="fas fa-shield-alt"></i> Enable 2FA
                                    </button>
                                </div>
                                <div class="setting-item">
                                    <div class="setting-info">
                                        <label>Biometric Login</label>
                                        <p>Use fingerprint or face ID to login</p>
                                    </div>
                                    <button class="btn-primary" onclick="setupBiometric()">
                                        <i class="fas fa-fingerprint"></i> Setup Biometric
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- My Applications Tab -->
                <div id="applications-tab" class="tab-content">
                    <div class="page-header">
                        <div>
                            <h2 class="page-title"><i class="fas fa-file-alt"></i> My Applications</h2>
                            <p class="page-subtitle">Track and manage all your government service applications</p>
                        </div>
                        <button class="btn-primary" onclick="showTab('services')">
                            <i class="fas fa-plus"></i> New Application
                        </button>
                    </div>

                    <div class="applications-filter">
                        <button class="filter-btn active" onclick="filterApplications('all')">All</button>
                        <button class="filter-btn" onclick="filterApplications('pending')">Pending</button>
                        <button class="filter-btn" onclick="filterApplications('approved')">Approved</button>
                        <button class="filter-btn" onclick="filterApplications('rejected')">Rejected</button>
                        <button class="filter-btn" onclick="filterApplications('completed')">Completed</button>
                    </div>

                    <div class="applications-list" id="applicationsList">
                        <!-- Applications will be populated by JavaScript -->
                    </div>
                </div>

            </main>
        </div>

        <!-- Language Modal -->
        <div id="languageModal" class="modal hidden">
            <div class="modal-content">
                <h3 data-i18n="language_modal_title">Choose Response Language</h3>
                <p class="modal-subtitle" data-i18n="language_modal_subtitle">भाषा छान्नुहोस् / Select Language</p>
                <div class="language-options">
                    <button class="language-btn blue" onclick="selectLanguage('english')">
                        <i class="fas fa-flag"></i>
                        <span>English</span>
                    </button>
                    <button class="language-btn red" onclick="selectLanguage('nepali')">
                        <i class="fas fa-flag"></i>
                        <span>नेपाली</span>
                    </button>
                </div>
                <button class="btn-secondary full-width" onclick="closeLanguageModal()">Cancel</button>
            </div>
        </div>

        <!-- Camera Modal for Profile Photo -->
        <div id="cameraModal" class="modal hidden">
            <div class="modal-content large">
                <div class="modal-header">
                    <h3><i class="fas fa-camera"></i> <span data-i18n="camera_title">Capture Photo</span></h3>
                    <button class="close-btn" onclick="closeCameraModal()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="camera-container">
                    <video id="cameraVideo" autoplay playsinline></video>
                    <canvas id="cameraCanvas" style="display: none;"></canvas>
                    <div class="camera-controls">
                        <button class="btn-primary" onclick="capturePhotoNow()">
                            <i class="fas fa-camera"></i> <span data-i18n="camera_capture">Capture</span>
                        </button>
                        <button class="btn-secondary" onclick="closeCameraModal()">
                            <span data-i18n="camera_cancel">Cancel</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- background music -->
        <audio id="bg-music" autoplay>
            <source src="back.mp3" type="audio/mpeg">
        </audio>

        <script>

            document.addEventListener("click", () => {
                setTimeout(() => {
                    const music = document.getElementById("bg-music");
                    music.muted = false; // unmute after delay
                    music.play().catch(err => {
                        console.log("Playback failed:", err);
                    });
                }, 1000);
            }, { once: true }); 
        </script>
        <script src="languages.js"></script>
        <script src="app.js"></script>

        <!-- Enhanced Citizen Portal Scripts -->
        <script>
            // News Portal Data and Functions
            var newsData = {
                federal: [
                    {
                        id: 1,
                        title: "New Digital Citizenship Card Rollout",
                        summary: "Federal government announces nationwide rollout of digital citizenship cards with blockchain security.",
                        content: "The Ministry of Home Affairs has launched a comprehensive digital citizenship program that will replace traditional paper cards. The new system uses blockchain technology to ensure security and prevent fraud.",
                        date: "2025-01-15",
                        category: "federal",
                        priority: "high",
                        image: "https://via.placeholder.com/400x250?text=Federal+Update",
                        tags: ["Citizenship", "Digital", "Security"]
                    },
                    {
                        id: 2,
                        title: "National Budget 2025-26 Approved",
                        summary: "Parliament approves Rs. 1.8 trillion budget focusing on infrastructure and digital governance.",
                        content: "The federal budget for fiscal year 2025-26 has been approved with major allocations for digital infrastructure, smart city projects, and e-governance initiatives.",
                        date: "2025-01-14",
                        category: "federal",
                        priority: "high",
                        image: "https://via.placeholder.com/400x250?text=Budget+2025",
                        tags: ["Budget", "Infrastructure", "Policy"]
                    },
                    {
                        id: 3,
                        title: "Coordination Hub Launched",
                        summary: "New coordination platform bridges local and federal government communication gaps.",
                        content: "The Smart Nagarik platform now includes a coordination hub that enables real-time communication between local municipalities, provincial governments, and federal ministries.",
                        date: "2025-01-13",
                        category: "federal",
                        priority: "high",
                        image: "https://via.placeholder.com/400x250?text=Coordination+Hub",
                        tags: ["Coordination", "Platform", "Innovation"]
                    }
                ],
                provincial: [
                    {
                        id: 4,
                        title: "Bagmati Province Digital Services Expansion",
                        summary: "Provincial government expands digital services to all 13 districts.",
                        content: "Bagmati Pradesh has successfully expanded its digital service delivery to all districts, enabling citizens to Featch Data government services online.",
                        date: "2025-01-12",
                        category: "provincial",
                        priority: "medium",
                        image: "https://via.placeholder.com/400x250?text=Bagmati+Province",
                        tags: ["Provincial", "Services", "Expansion"]
                    },
                    {
                        id: 5,
                        title: "Gandaki Province Smart City Initiative",
                        summary: "Pokhara selected for smart city development under provincial initiative.",
                        content: "Gandaki Pradesh has selected Pokhara as the first smart city in the province, with plans for integrated digital infrastructure and citizen services.",
                        date: "2025-01-11",
                        category: "provincial",
                        priority: "medium",
                        image: "https://via.placeholder.com/400x250?text=Smart+City",
                        tags: ["Smart City", "Development", "Infrastructure"]
                    }
                ],
                local: [
                    {
                        id: 6,
                        title: "Kathmandu Metropolitan City - Online Permit System",
                        summary: "KMC launches online building permit and business registration system.",
                        content: "Kathmandu Metropolitan City has launched a fully digital permit system, reducing processing time from weeks to days.",
                        date: "2025-01-10",
                        category: "local",
                        priority: "medium",
                        image: "https://via.placeholder.com/400x250?text=KMC+Update",
                        tags: ["Local", "Permits", "Digital"]
                    },
                    {
                        id: 7,
                        title: "Lalitpur Municipality - Waste Management App",
                        summary: "New mobile app connects citizens with waste collection services.",
                        content: "Lalitpur Municipality has launched a mobile application that allows citizens to schedule waste collection and track service delivery in real-time.",
                        date: "2025-01-09",
                        category: "local",
                        priority: "low",
                        image: "https://via.placeholder.com/400x250?text=Waste+Management",
                        tags: ["Local", "App", "Environment"]
                    },
                    {
                        id: 8,
                        title: "Bhaktapur Municipality - Property Tax Online Payment",
                        summary: "Property tax can now be paid online through Smart Nagarik portal.",
                        content: "Bhaktapur Municipality has integrated property tax payment into the Smart Nagarik platform, enabling citizens to pay taxes online with instant receipt generation.",
                        date: "2025-01-08",
                        category: "local",
                        priority: "medium",
                        image: "https://via.placeholder.com/400x250?text=Tax+Payment",
                        tags: ["Local", "Tax", "Payment"]
                    }
                ]
            };

            var servicesData = [
                { id: 1, name: "Digital Citizenship Card", category: "citizenship", icon: "fa-id-card", description: "Apply for and manage your digital citizenship card" },
                { id: 2, name: "Passport Application", category: "passport", icon: "fa-passport", description: "Apply for new passport or renew existing one" },
                { id: 3, name: "Birth Certificate", category: "documents", icon: "fa-certificate", description: "Apply for birth certificate online" },
                { id: 4, name: "Marriage Certificate", category: "documents", icon: "fa-heart", description: "Register marriage and get certificate" },
                { id: 5, name: "Death Certificate", category: "documents", icon: "fa-file-alt", description: "Apply for death certificate" },
                { id: 6, name: "Driving License", category: "licenses", icon: "fa-id-badge", description: "Apply for or renew driving license" },
                { id: 7, name: "Business Registration", category: "licenses", icon: "fa-briefcase", description: "Register your business online" },
                { id: 8, name: "Property Registration", category: "documents", icon: "fa-home", description: "Register property documents" },
                { id: 9, name: "Electricity Bill Payment", category: "payments", icon: "fa-bolt", description: "Pay electricity bills online" },
                { id: 10, name: "Water Bill Payment", category: "payments", icon: "fa-tint", description: "Pay water supply bills" },
                { id: 11, name: "Internet Bill Payment", category: "payments", icon: "fa-wifi", description: "Pay internet and telecom bills" },
                { id: 12, name: "Tax Payment", category: "payments", icon: "fa-file-invoice-dollar", description: "Pay income and property taxes" },
                { id: 13, name: "Vehicle Registration", category: "licenses", icon: "fa-car", description: "Register new vehicle or transfer ownership" },
                { id: 14, name: "Building Permit", category: "licenses", icon: "fa-building", description: "Apply for building construction permit" },
                { id: 15, name: "Health Insurance", category: "utilities", icon: "fa-heartbeat", description: "Apply for government health insurance" },
                { id: 16, name: "Social Security", category: "utilities", icon: "fa-shield-alt", description: "Register for social security benefits" },
                { id: 17, name: "Education Certificate Verification", category: "documents", icon: "fa-graduation-cap", description: "Verify educational certificates" },
                { id: 18, name: "Police Clearance", category: "documents", icon: "fa-user-shield", description: "Apply for police clearance certificate" },
                { id: 19, name: "Land Survey", category: "documents", icon: "fa-map", description: "Request land survey services" },
                { id: 20, name: "Grievance Filing", category: "utilities", icon: "fa-comment-alt", description: "File complaints and grievances" }
            ];

            // Initialize News Portal
            function initializeNewsPortal() {
                renderFeaturedNews();
                renderNewsGrid();
                renderTrendingNews();
                renderPolicyChanges();
                renderUpcomingEvents();
            }

            function renderFeaturedNews() {
                const featured = newsData.federal[0];
                const featuredEl = document.getElementById('featuredNews');
                if (featuredEl) {
                    featuredEl.innerHTML = `
                    <div class="featured-image" style="background-image: url('${featured.image}');">
                        <div class="featured-badge">${featured.category.toUpperCase()}</div>
                    </div>
                    <div class="featured-content">
                        <div class="featured-meta">
                            <span><i class="fas fa-calendar"></i> ${formatDate(featured.date)}</span>
                            <span><i class="fas fa-tag"></i> ${featured.tags.join(', ')}</span>
                        </div>
                        <h2>${featured.title}</h2>
                        <p>${featured.summary}</p>
                        <button class="btn-primary" onclick="openNewsDetail(${featured.id})">Read More</button>
                    </div>
                `;
                }
            }

            function renderNewsGrid() {
                const gridEl = document.getElementById('newsGrid');
                if (!gridEl) return;

                const allNews = [...newsData.federal, ...newsData.provincial, ...newsData.local];
                gridEl.innerHTML = allNews.map(news => `
                <div class="news-card" data-category="${news.category}">
                    <div class="news-card-image" style="background-image: url('${news.image}');">
                        <span class="news-badge ${news.category}">${news.category}</span>
                    </div>
                    <div class="news-card-content">
                        <div class="news-meta">
                            <span><i class="fas fa-calendar"></i> ${formatDate(news.date)}</span>
                            <span class="priority ${news.priority}">${news.priority}</span>
                        </div>
                        <h3>${news.title}</h3>
                        <p>${news.summary}</p>
                        <div class="news-tags">
                            ${news.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                        </div>
                        <button class="btn-text" onclick="openNewsDetail(${news.id})">Read More <i class="fas fa-arrow-right"></i></button>
                    </div>
                </div>
            `).join('');
            }

            function renderTrendingNews() {
                const trendingEl = document.getElementById('trendingNews');
                if (!trendingEl) return;

                const trending = newsData.federal.slice(0, 5);
                trendingEl.innerHTML = trending.map((news, index) => `
                <div class="trending-item">
                    <span class="trend-number">${index + 1}</span>
                    <div>
                        <h4 onclick="openNewsDetail(${news.id})">${news.title}</h4>
                        <small>${formatDate(news.date)}</small>
                    </div>
                </div>
            `).join('');
            }

            function renderPolicyChanges() {
                const policyEl = document.getElementById('policyChanges');
                if (!policyEl) return;

                const policies = [
                    { title: "Digital Service Act 2025", date: "2025-01-15", status: "Active" },
                    { title: "Data Protection Regulation", date: "2025-01-10", status: "Draft" },
                    { title: "E-Governance Framework", date: "2025-01-05", status: "Active" }
                ];

                policyEl.innerHTML = policies.map(policy => `
                <div class="policy-item">
                    <h4>${policy.title}</h4>
                    <div class="policy-meta">
                        <span>${formatDate(policy.date)}</span>
                        <span class="status ${policy.status.toLowerCase()}">${policy.status}</span>
                    </div>
                </div>
            `).join('');
            }

            function renderUpcomingEvents() {
                const eventsEl = document.getElementById('upcomingEvents');
                if (!eventsEl) return;

                const events = [
                    { title: "Digital Governance Summit", date: "2025-02-01", location: "Kathmandu" },
                    { title: "Citizen Service Fair", date: "2025-02-15", location: "Pokhara" },
                    { title: "E-Government Workshop", date: "2025-02-20", location: "Lalitpur" }
                ];

                eventsEl.innerHTML = events.map(event => `
                <div class="event-item">
                    <div class="event-date">
                        <span class="day">${new Date(event.date).getDate()}</span>
                        <span class="month">${new Date(event.date).toLocaleString('default', { month: 'short' })}</span>
                    </div>
                    <div class="event-details">
                        <h4>${event.title}</h4>
                        <p><i class="fas fa-map-marker-alt"></i> ${event.location}</p>
                    </div>
                </div>
            `).join('');
            }

            function filterNews(category) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');

                const gridEl = document.getElementById('newsGrid');
                const cards = gridEl.querySelectorAll('.news-card');

                cards.forEach(card => {
                    if (category === 'all' || card.dataset.category === category) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            function openNewsDetail(newsId) {
                const allNews = [...newsData.federal, ...newsData.provincial, ...newsData.local];
                const news = allNews.find(n => n.id === newsId);
                if (news) {
                    alert(`News Detail:\n\n${news.title}\n\n${news.content}\n\nDate: ${formatDate(news.date)}\nCategory: ${news.category}`);
                }
            }

            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
            }

            // Services Functions
            function initializeServices() {
                renderServices();
            }

            function renderServices() {
                const gridEl = document.getElementById('servicesGrid');
                if (!gridEl) return;

                gridEl.innerHTML = servicesData.map(service => `
                <div class="service-card-item" data-category="${service.category}">
                    <div class="service-icon">
                        <i class="fas ${service.icon}"></i>
                    </div>
                    <h3>${service.name}</h3>
                    <p>${service.description}</p>
                    <button class="btn-primary" onclick="openService('${service.name}')">Featch Data Service</button>
                </div>
            `).join('');
            }

            function filterServices() {
                const searchTerm = document.getElementById('serviceSearch')?.value.toLowerCase() || '';
                const cards = document.querySelectorAll('.service-card-item');

                cards.forEach(card => {
                    const text = card.textContent.toLowerCase();
                    card.style.display = text.includes(searchTerm) ? 'block' : 'none';
                });
            }

            function filterByCategory(category) {
                document.querySelectorAll('.category-tab').forEach(tab => tab.classList.remove('active'));
                event.target.classList.add('active');

                const cards = document.querySelectorAll('.service-card-item');
                cards.forEach(card => {
                    if (category === 'all' || card.dataset.category === category) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            function openService(serviceName) {
                showToast(`Opening ${serviceName}...`);
                // In real implementation, this would navigate to the service page
            }

            // Enhanced Dashboard Functions
            async function enhanceDashboard() {
                updateDashboardStats();
                loadRecentActivity();
                await loadImportantNotices(); // Make sure this is called
                loadPopularServices();
            }

            function updateDashboardStats() {
                // Animate counters
                document.querySelectorAll('.counter').forEach(counter => {
                    const target = parseInt(counter.dataset.target);
                    const duration = 2000;
                    const increment = target / (duration / 16);
                    let current = 0;

                    const timer = setInterval(() => {
                        current += increment;
                        if (current >= target) {
                            counter.textContent = target.toLocaleString();
                            clearInterval(timer);
                        } else {
                            counter.textContent = Math.floor(current).toLocaleString();
                        }
                    }, 16);
                });
            }

            function loadRecentActivity() {
                const activityEl = document.getElementById('recentActivity');
                if (!activityEl) return;

                const activities = [
                    { type: 'application', text: 'Passport application submitted', time: '2 hours ago', status: 'pending' },
                    { type: 'document', text: 'Birth certificate approved', time: '1 day ago', status: 'completed' },
                    { type: 'update', text: 'Profile information updated', time: '2 days ago', status: 'completed' },
                    { type: 'news', text: 'Read federal government update', time: '3 days ago', status: 'completed' },
                    { type: 'application', text: 'Driving license renewal in progress', time: '4 days ago', status: 'pending' }
                ];

                activityEl.innerHTML = activities.map(activity => `
                <div class="activity-item ${activity.status}">
                    <div class="activity-icon">
                        <i class="fas fa-${getActivityIcon(activity.type)}"></i>
                    </div>
                    <div class="activity-content">
                        <p>${activity.text}</p>
                        <small>${activity.time}</small>
                    </div>
                </div>
            `).join('');
            }

            async function loadImportantNotices() {
                const noticesEl = document.getElementById('importantNotices');
                if (!noticesEl) {
                    console.warn('importantNotices element not found');
                    return;
                }

                var API_BASE_URL = 'http://localhost:3000/api';
                let notices = [];

                // Try to Access from backend API first
                try {
                    const response = await Access(`${API_BASE_URL}/notices`, {
                        method: 'GET',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        cache: 'no-cache'
                    });

                    if (response.ok) {
                        const result = await response.json();
                        if (result.success && result.data && Array.isArray(result.data)) {
                            notices = result.data;
                            console.log('✅ Loaded', notices.length, 'notices from backend');
                        } else {
                            console.warn('Backend returned invalid data:', result);
                        }
                    } else {
                        console.warn('Backend response not OK:', response.status);
                    }
                } catch (error) {
                    console.warn('Backend API not available, trying localStorage fallback:', error);

                    // Fallback to localStorage if backend is not available
                    try {
                        const savedNotices = localStorage.getItem('governmentNotices');
                        if (savedNotices) {
                            notices = JSON.parse(savedNotices);
                            console.log('✅ Loaded', notices.length, 'notices from localStorage');
                        }
                    } catch (e) {
                        console.warn('Error loading notices from localStorage:', e);
                    }
                }

                // Fallback to default notices if none exist
                if (notices.length === 0) {
                    console.log('No notices found, showing default notices');
                    notices = [
                        { title: 'Coordination Hub Now Live', date: '2025-01-15', priority: 'high', icon: 'fa-bullhorn' },
                        { title: 'New Digital Services Available', date: '2025-01-14', priority: 'high', icon: 'fa-bell' },
                        { title: 'Federal-Local Coordination Updates', date: '2025-01-13', priority: 'medium', icon: 'fa-network-wired' },
                        { title: 'Government News Portal Launched', date: '2025-01-12', priority: 'medium', icon: 'fa-newspaper' }
                    ];
                }

                // Sort by date (newest first) and limit to 10 most recent
                notices = notices.sort((a, b) => {
                    const dateA = new Date(a.date || a.createdAt || 0);
                    const dateB = new Date(b.date || b.createdAt || 0);
                    return dateB - dateA;
                }).slice(0, 10);

                // Render notices
                if (notices.length > 0) {
                    noticesEl.innerHTML = notices.map(notice => {
                        const priority = notice.priority || 'medium';
                        const icon = notice.icon || 'fa-bullhorn';
                        const title = notice.title || 'Untitled Notice';
                        const desc = notice.desc || notice.description || '';
                        const date = notice.date || notice.createdAt;
                        const link = notice.link || '';

                        return `
                        <div class="notice-item ${priority}" onclick="${link ? `window.open('${link}', '_blank')` : "showTab('news')"}" style="cursor: pointer;">
                            <div class="notice-icon">
                                <i class="fas ${icon}"></i>
                            </div>
                            <div>
                                <h4>${title}</h4>
                                ${desc ? `<p style="font-size: 0.85rem; color: #64748b; margin-top: 0.25rem;">${desc}</p>` : ''}
                                <small>${date ? formatDate(date) : 'Recently'}</small>
                            </div>
                        </div>
                    `;
                    }).join('');
                    console.log('✅ Rendered', notices.length, 'notices in Important Notices section');
                } else {
                    noticesEl.innerHTML = '<p style="color: #64748b; padding: 1rem; text-align: center;">No notices available</p>';
                }
            }

            // Auto-refresh notices every 10 seconds
            setInterval(() => {
                loadImportantNotices();
            }, 10000);

            function loadPopularServices() {
                const servicesEl = document.getElementById('popularServices');
                if (!servicesEl) return;

                const popular = servicesData.slice(0, 6);
                servicesEl.innerHTML = popular.map(service => `
                <div class="service-shortcut" onclick="openService('${service.name}')">
                    <i class="fas ${service.icon}"></i>
                    <span>${service.name}</span>
                </div>
            `).join('');
            }

            function getActivityIcon(type) {
                const icons = {
                    'application': 'file-alt',
                    'document': 'file-check',
                    'payment': 'credit-card',
                    'update': 'edit',
                    'news': 'newspaper'
                };
                return icons[type] || 'circle';
            }

            // Applications Management
            const applicationsData = [
                {
                    id: 'APP-2025-001',
                    service: 'Passport Application',
                    status: 'pending',
                    submittedDate: '2025-01-10',
                    lastUpdate: '2025-01-12',
                    description: 'New passport application for international travel',
                    progress: 60
                },
                {
                    id: 'APP-2025-002',
                    service: 'Birth Certificate',
                    status: 'approved',
                    submittedDate: '2025-01-05',
                    lastUpdate: '2025-01-08',
                    description: 'Birth certificate application for child',
                    progress: 100
                },
                {
                    id: 'APP-2025-003',
                    service: 'Driving License Renewal',
                    status: 'pending',
                    submittedDate: '2025-01-08',
                    lastUpdate: '2025-01-09',
                    description: 'Renewal of driving license',
                    progress: 40
                },
                {
                    id: 'APP-2024-045',
                    service: 'Citizenship Card',
                    status: 'completed',
                    submittedDate: '2024-12-15',
                    lastUpdate: '2024-12-28',
                    description: 'Digital citizenship card application',
                    progress: 100
                },
                {
                    id: 'APP-2025-004',
                    service: 'Property Registration',
                    status: 'rejected',
                    submittedDate: '2025-01-03',
                    lastUpdate: '2025-01-07',
                    description: 'Property registration application',
                    progress: 0,
                    rejectionReason: 'Missing required documents'
                }
            ];

            function initializeApplications() {
                renderApplications();
            }

            function renderApplications(filter = 'all') {
                const listEl = document.getElementById('applicationsList');
                if (!listEl) return;

                let filtered = applicationsData;
                if (filter !== 'all') {
                    filtered = applicationsData.filter(app => app.status === filter);
                }

                if (filtered.length === 0) {
                    listEl.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>No applications found</h3>
                        <p>You don't have any ${filter === 'all' ? '' : filter} applications yet.</p>
                        <button class="btn-primary" onclick="showTab('services')">Browse Services</button>
                    </div>
                `;
                    return;
                }

                listEl.innerHTML = filtered.map(app => `
                <div class="application-card" data-status="${app.status}">
                    <div class="application-header">
                        <div class="application-id">
                            <i class="fas fa-hashtag"></i>
                            <strong>${app.id}</strong>
                        </div>
                        <span class="status-badge ${app.status}">${app.status.charAt(0).toUpperCase() + app.status.slice(1)}</span>
                    </div>
                    <div class="application-body">
                        <h3>${app.service}</h3>
                        <p>${app.description}</p>
                        <div class="application-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${app.progress}%"></div>
                            </div>
                            <span>${app.progress}% Complete</span>
                        </div>
                        ${app.rejectionReason ? `<div class="rejection-notice"><i class="fas fa-exclamation-triangle"></i> ${app.rejectionReason}</div>` : ''}
                    </div>
                    <div class="application-footer">
                        <div class="application-dates">
                            <span><i class="fas fa-calendar-plus"></i> Submitted: ${formatDate(app.submittedDate)}</span>
                            <span><i class="fas fa-calendar-check"></i> Updated: ${formatDate(app.lastUpdate)}</span>
                        </div>
                        <div class="application-actions">
                            <button class="btn-text" onclick="viewApplicationDetails('${app.id}')">View Details</button>
                            ${app.status === 'pending' ? `<button class="btn-text" onclick="trackApplication('${app.id}')">Track</button>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
            }

            function filterApplications(status) {
                document.querySelectorAll('.applications-filter .filter-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                event.target.classList.add('active');
                renderApplications(status);
            }

            function viewApplicationDetails(appId) {
                const app = applicationsData.find(a => a.id === appId);
                if (app) {
                    alert(`Application Details:\n\nID: ${app.id}\nService: ${app.service}\nStatus: ${app.status}\nProgress: ${app.progress}%\n\nSubmitted: ${formatDate(app.submittedDate)}\nLast Update: ${formatDate(app.lastUpdate)}`);
                }
            }

            function trackApplication(appId) {
                showToast(`Tracking application ${appId}...`);
                // In real implementation, this would show detailed tracking
            }

            // Enhanced AI Assistant
            function enhanceAIAssistant() {
                // Update AI context for coordination theme
                if (window.callGeminiAPI) {
                    const originalCall = window.callGeminiAPI;
                    window.callGeminiAPI = function (message) {
                        const enhancedMessage = `You are a helpful assistant for Smart Nagarik citizen portal. The platform focuses on coordination between local and federal government. Help citizens with government services, track applications, and explain coordination features. User question: ${message}`;
                        return originalCall(enhancedMessage);
                    };
                }
            }

            // Ensure showTab function handles news tab
            const originalShowTab = window.showTab;
            window.showTab = function (tabName) {
                // Hide all tabs
                document.querySelectorAll('.tab-content').forEach(tab => {
                    tab.classList.remove('active');
                });

                // Remove active from all nav buttons
                document.querySelectorAll('.nav-btn').forEach(btn => {
                    btn.classList.remove('active');
                });

                // Show selected tab
                const targetTab = document.getElementById(`${tabName}-tab`);
                if (targetTab) {
                    targetTab.classList.add('active');
                }

                // Activate corresponding nav button
                const navBtn = Array.from(document.querySelectorAll('.nav-btn')).find(btn =>
                    btn.getAttribute('onclick')?.includes(`showTab('${tabName}')`)
                );
                if (navBtn) {
                    navBtn.classList.add('active');
                }

                // Initialize content if needed
                if (tabName === 'news' && document.getElementById('newsGrid') && !document.getElementById('newsGrid').innerHTML) {
                    initializeNewsPortal();
                }
                if (tabName === 'services' && document.getElementById('servicesGrid') && !document.getElementById('servicesGrid').innerHTML) {
                    initializeServices();
                }
                if (tabName === 'applications' && document.getElementById('applicationsList') && !document.getElementById('applicationsList').innerHTML) {
                    initializeApplications();
                }
                if (tabName === 'dashboard') {
                    enhanceDashboard();
                }

                // Call original if exists
                if (originalShowTab && typeof originalShowTab === 'function') {
                    originalShowTab(tabName);
                }
            };

            // Initialize everything when DOM is ready
            document.addEventListener('DOMContentLoaded', function () {
                // Wait for app.js to load
                setTimeout(() => {
                    initializeNewsPortal();
                    initializeServices();
                    initializeApplications();
                    enhanceDashboard();
                    enhanceAIAssistant();
                }, 500);
            });

            // Show toast notification
            function showToast(message) {
                const toast = document.getElementById('successToast');
                const messageEl = document.getElementById('toastMessage');
                if (toast && messageEl) {
                    messageEl.textContent = message;
                    toast.classList.remove('hidden');
                    setTimeout(() => {
                        toast.classList.add('hidden');
                    }, 3000);
                }
            }
        </script>

        <style>
            /* News Portal Styles */
            .news-container {
                display: grid;
                grid-template-columns: 1fr 350px;
                gap: 2rem;
                margin-top: 2rem;
            }

            .featured-news-card {
                background: var(--card-bg, #fff);
                border-radius: 1rem;
                overflow: hidden;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                margin-bottom: 2rem;
            }

            .featured-image {
                height: 300px;
                background-size: cover;
                background-position: center;
                position: relative;
            }

            .featured-badge {
                position: absolute;
                top: 1rem;
                right: 1rem;
                background: var(--primary-red, #dc2626);
                color: white;
                padding: 0.5rem 1rem;
                border-radius: 0.5rem;
                font-weight: 600;
                font-size: 0.875rem;
            }

            .featured-content {
                padding: 2rem;
            }

            .featured-meta {
                display: flex;
                gap: 1.5rem;
                margin-bottom: 1rem;
                color: #666;
                font-size: 0.875rem;
            }

            .featured-content h2 {
                font-size: 1.75rem;
                margin-bottom: 1rem;
                color: var(--text-primary, #1a1a1a);
            }

            .news-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
                gap: 1.5rem;
            }

            .news-card {
                background: var(--card-bg, #fff);
                border-radius: 1rem;
                overflow: hidden;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s, box-shadow 0.3s;
            }

            .news-card:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            }

            .news-card-image {
                height: 180px;
                background-size: cover;
                background-position: center;
                position: relative;
            }

            .news-badge {
                position: absolute;
                top: 0.75rem;
                left: 0.75rem;
                padding: 0.25rem 0.75rem;
                border-radius: 0.375rem;
                font-size: 0.75rem;
                font-weight: 600;
                color: white;
            }

            .news-badge.federal {
                background: #dc2626;
            }

            .news-badge.provincial {
                background: #2563eb;
            }

            .news-badge.local {
                background: #10b981;
            }

            .news-card-content {
                padding: 1.5rem;
            }

            .news-meta {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.75rem;
                font-size: 0.875rem;
                color: #666;
            }

            .priority {
                padding: 0.25rem 0.5rem;
                border-radius: 0.25rem;
                font-size: 0.75rem;
                font-weight: 600;
            }

            .priority.high {
                background: #fee2e2;
                color: #dc2626;
            }

            .priority.medium {
                background: #dbeafe;
                color: #2563eb;
            }

            .priority.low {
                background: #d1fae5;
                color: #10b981;
            }

            .news-card-content h3 {
                font-size: 1.125rem;
                margin-bottom: 0.5rem;
                color: var(--text-primary, #1a1a1a);
            }

            .news-tags {
                display: flex;
                flex-wrap: wrap;
                gap: 0.5rem;
                margin: 1rem 0;
            }

            .tag {
                background: #f3f4f6;
                padding: 0.25rem 0.75rem;
                border-radius: 0.375rem;
                font-size: 0.75rem;
                color: #666;
            }

            .news-sidebar {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
            }

            .news-widget {
                background: var(--card-bg, #fff);
                border-radius: 1rem;
                padding: 1.5rem;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .news-widget h3 {
                font-size: 1.125rem;
                margin-bottom: 1rem;
                color: var(--text-primary, #1a1a1a);
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .trending-item {
                display: flex;
                gap: 1rem;
                padding: 0.75rem 0;
                border-bottom: 1px solid #e5e7eb;
                cursor: pointer;
            }

            .trending-item:last-child {
                border-bottom: none;
            }

            .trend-number {
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--primary-blue, #2563eb);
                min-width: 2rem;
            }

            .trending-item h4 {
                font-size: 0.875rem;
                margin-bottom: 0.25rem;
                color: var(--text-primary, #1a1a1a);
            }

            .policy-item,
            .event-item {
                padding: 0.75rem 0;
                border-bottom: 1px solid #e5e7eb;
            }

            .policy-item:last-child,
            .event-item:last-child {
                border-bottom: none;
            }

            .policy-item h4 {
                font-size: 0.875rem;
                margin-bottom: 0.5rem;
            }

            .policy-meta {
                display: flex;
                justify-content: space-between;
                font-size: 0.75rem;
                color: #666;
            }

            .status {
                padding: 0.25rem 0.5rem;
                border-radius: 0.25rem;
                font-weight: 600;
            }

            .status.active {
                background: #d1fae5;
                color: #10b981;
            }

            .status.draft {
                background: #fef3c7;
                color: #f59e0b;
            }

            .event-item {
                display: flex;
                gap: 1rem;
            }

            .event-date {
                background: var(--primary-blue, #2563eb);
                color: white;
                padding: 0.5rem;
                border-radius: 0.5rem;
                text-align: center;
                min-width: 3rem;
            }

            .event-date .day {
                display: block;
                font-size: 1.25rem;
                font-weight: 700;
            }

            .event-date .month {
                display: block;
                font-size: 0.75rem;
                text-transform: uppercase;
            }

            .event-details h4 {
                font-size: 0.875rem;
                margin-bottom: 0.25rem;
            }

            .news-filter-tabs {
                display: flex;
                gap: 0.5rem;
            }

            .filter-btn {
                padding: 0.5rem 1rem;
                border: 1px solid #e5e7eb;
                background: white;
                border-radius: 0.5rem;
                cursor: pointer;
                transition: all 0.3s;
            }

            .filter-btn.active {
                background: var(--primary-blue, #2563eb);
                color: white;
                border-color: var(--primary-blue, #2563eb);
            }

            /* Services Grid Styles */
            .services-category-tabs {
                display: flex;
                gap: 0.5rem;
                margin: 1.5rem 0;
                flex-wrap: wrap;
            }

            .category-tab {
                padding: 0.5rem 1rem;
                border: 1px solid #e5e7eb;
                background: white;
                border-radius: 0.5rem;
                cursor: pointer;
                transition: all 0.3s;
            }

            .category-tab.active {
                background: var(--primary-blue, #2563eb);
                color: white;
                border-color: var(--primary-blue, #2563eb);
            }

            .services-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 1.5rem;
            }

            .service-card-item {
                background: var(--card-bg, #fff);
                border-radius: 1rem;
                padding: 1.5rem;
                text-align: center;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                transition: transform 0.3s, box-shadow 0.3s;
            }

            .service-card-item:hover {
                transform: translateY(-4px);
                box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
            }

            .service-icon {
                width: 4rem;
                height: 4rem;
                margin: 0 auto 1rem;
                background: linear-gradient(135deg, var(--primary-red, #dc2626), var(--primary-blue, #2563eb));
                border-radius: 1rem;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1.5rem;
                color: white;
            }

            .service-card-item h3 {
                font-size: 1.125rem;
                margin-bottom: 0.5rem;
                color: var(--text-primary, #1a1a1a);
            }

            .service-card-item p {
                font-size: 0.875rem;
                color: #666;
                margin-bottom: 1rem;
            }

            .search-box {
                position: relative;
                width: 300px;
            }

            .search-box i {
                position: absolute;
                left: 1rem;
                top: 50%;
                transform: translateY(-50%);
                color: #666;
            }

            .search-box input {
                width: 100%;
                padding: 0.75rem 1rem 0.75rem 2.5rem;
                border: 1px solid #e5e7eb;
                border-radius: 0.5rem;
                font-size: 0.875rem;
            }

            @media (max-width: 1024px) {
                .news-container {
                    grid-template-columns: 1fr;
                }

                .news-sidebar {
                    order: -1;
                }
            }

            @media (max-width: 768px) {
                .news-grid {
                    grid-template-columns: 1fr;
                }

                .services-grid {
                    grid-template-columns: 1fr;
                }
            }

            /* Applications Tab Styles */
            .applications-filter {
                display: flex;
                gap: 0.5rem;
                margin: 1.5rem 0;
                flex-wrap: wrap;
            }

            .applications-list {
                display: flex;
                flex-direction: column;
                gap: 1.5rem;
                margin-top: 1.5rem;
            }

            .application-card {
                background: var(--card-bg, #fff);
                border-radius: 1rem;
                padding: 1.5rem;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                border-left: 4px solid #e5e7eb;
                transition: all 0.3s;
            }

            .application-card:hover {
                box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
                transform: translateY(-2px);
            }

            .application-card[data-status="pending"] {
                border-left-color: #f59e0b;
            }

            .application-card[data-status="approved"] {
                border-left-color: #10b981;
            }

            .application-card[data-status="completed"] {
                border-left-color: #2563eb;
            }

            .application-card[data-status="rejected"] {
                border-left-color: #dc2626;
            }

            .application-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1rem;
            }

            .application-id {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: #666;
                font-size: 0.875rem;
            }

            .status-badge {
                padding: 0.25rem 0.75rem;
                border-radius: 0.375rem;
                font-size: 0.75rem;
                font-weight: 600;
                text-transform: capitalize;
            }

            .status-badge.pending {
                background: #fef3c7;
                color: #f59e0b;
            }

            .status-badge.approved {
                background: #d1fae5;
                color: #10b981;
            }

            .status-badge.completed {
                background: #dbeafe;
                color: #2563eb;
            }

            .status-badge.rejected {
                background: #fee2e2;
                color: #dc2626;
            }

            .application-body h3 {
                font-size: 1.125rem;
                margin-bottom: 0.5rem;
                color: var(--text-primary, #1a1a1a);
            }

            .application-body p {
                color: #666;
                font-size: 0.875rem;
                margin-bottom: 1rem;
            }

            .application-progress {
                margin: 1rem 0;
            }

            .progress-bar {
                width: 100%;
                height: 8px;
                background: #e5e7eb;
                border-radius: 4px;
                overflow: hidden;
                margin-bottom: 0.5rem;
            }

            .progress-fill {
                height: 100%;
                background: linear-gradient(90deg, var(--primary-blue, #2563eb), var(--primary-red, #dc2626));
                transition: width 0.3s;
            }

            .application-progress span {
                font-size: 0.75rem;
                color: #666;
            }

            .rejection-notice {
                background: #fee2e2;
                color: #dc2626;
                padding: 0.75rem;
                border-radius: 0.5rem;
                margin-top: 1rem;
                font-size: 0.875rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .application-footer {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 1rem;
                padding-top: 1rem;
                border-top: 1px solid #e5e7eb;
            }

            .application-dates {
                display: flex;
                flex-direction: column;
                gap: 0.25rem;
                font-size: 0.75rem;
                color: #666;
            }

            .application-dates span {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .application-actions {
                display: flex;
                gap: 1rem;
            }

            .empty-state {
                text-align: center;
                padding: 3rem;
                color: #666;
            }

            .empty-state i {
                font-size: 4rem;
                color: #d1d5db;
                margin-bottom: 1rem;
            }

            .empty-state h3 {
                margin-bottom: 0.5rem;
                color: var(--text-primary, #1a1a1a);
            }

            /* Coordination Card Styles */
            .coordination-summary {
                margin: 1rem 0;
            }

            .coordination-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.75rem 0;
                border-bottom: 1px solid #e5e7eb;
            }

            .coordination-item:last-child {
                border-bottom: none;
            }

            .coordination-item span {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                color: #666;
                font-size: 0.875rem;
            }

            .coordination-item strong {
                font-size: 1.25rem;
                color: var(--text-primary, #1a1a1a);
            }

            /* Orange stat card */
            .stat-card.orange {
                background: linear-gradient(135deg, #f97316, #fb923c);
            }

            @media (max-width: 768px) {
                .application-footer {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 1rem;
                }

                .application-actions {
                    width: 100%;
                    justify-content: space-between;
                }
            }
        </style>
</body>

</html>